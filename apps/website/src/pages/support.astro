---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getLangFromUrl } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url); // Will be 'en'

// SEO Configuration for Support Page
const title = 'Support & Help Center | Praxis Navigator Customer Support';
const description =
  'Get help with Praxis Navigator behavioral security monitoring platform. Contact our expert support team, access documentation, and find answers to common questions.';
const keywords =
  'Praxis Navigator support, customer support, help center, technical support, security platform help, behavioral monitoring support, Microsoft Graph API help';

// Structured Data for Support Service
const supportSchema = {
  '@context': 'https://schema.org',
  '@type': 'ContactPage',
  name: 'Praxis Navigator Support',
  description: 'Customer support and help center for Praxis Navigator platform',
  url: 'https://praxisnavigator.io/support',
  mainEntity: {
    '@type': 'Organization',
    name: 'Praxis Security Labs',
    url: 'https://praxisnavigator.io',
    contactPoint: {
      '@type': 'ContactPoint',
      contactType: 'Customer Support',
      availableLanguage: ['English', 'Norwegian'],
      hoursAvailable: {
        '@type': 'OpeningHoursSpecification',
        dayOfWeek: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
        opens: '08:00',
        closes: '17:00',
        timeZone: 'Europe/Oslo',
      },
    },
  },
};
---

<BaseLayout
  title={title}
  description={description}
  keywords={keywords}
  pageType="contact"
  structuredData={supportSchema}
  ogImage="/images/support/support-og.png"
  ogType="website"
  lang={lang}
>
  <!-- Hero Section -->
  <section class="py-20 bg-gradient-to-b from-praxis-blue to-praxis-sky">
    <div class="container mx-auto px-6">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="h1 text-praxis-white mb-8">Support & Help Center</h1>

        <p class="body-large text-praxis-sky-100 mb-12 max-w-3xl mx-auto">
          Get expert assistance with Praxis Navigator platform. Our security
          specialists are here to help you maximize your behavioral monitoring
          capabilities.
        </p>
      </div>
    </div>
  </section>

  <!-- Support Contact Form Section -->
  <section class="py-20 bg-praxis-white">
    <div class="container mx-auto px-6">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-16">
          <h2 class="h2 text-praxis-dark-blue mb-6">How Can We Help You?</h2>
          <p class="body-large text-praxis-black max-w-3xl mx-auto">
            Fill out the form below and our support team will get back to you as
            soon as possible
          </p>
        </div>

        <div class="bg-praxis-tan-50 rounded-xl p-8 lg:p-12">
          <form id="support-form" class="space-y-6">
            <!-- Form Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Name -->
              <div>
                <label
                  for="name"
                  class="block text-sm font-medium text-praxis-dark-blue mb-2"
                >
                  Full Name *
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="w-full px-4 py-3 border border-praxis-gray rounded-lg focus:ring-2 focus:ring-praxis-blue focus:border-praxis-blue transition-colors"
                  placeholder="Your full name"
                />
              </div>

              <!-- Email -->
              <div>
                <label
                  for="email"
                  class="block text-sm font-medium text-praxis-dark-blue mb-2"
                >
                  Email Address *
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="w-full px-4 py-3 border border-praxis-gray rounded-lg focus:ring-2 focus:ring-praxis-blue focus:border-praxis-blue transition-colors"
                  placeholder="your.email@company.com"
                />
              </div>
            </div>

            <!-- Company -->
            <div>
              <label
                for="company"
                class="block text-sm font-medium text-praxis-dark-blue mb-2"
              >
                Company/Organization
              </label>
              <input
                type="text"
                id="company"
                name="company"
                class="w-full px-4 py-3 border border-praxis-gray rounded-lg focus:ring-2 focus:ring-praxis-blue focus:border-praxis-blue transition-colors"
                placeholder="Your company name"
              />
            </div>

            <!-- Support Type -->
            <div>
              <label
                for="supportType"
                class="block text-sm font-medium text-praxis-dark-blue mb-2"
              >
                Support Type *
              </label>
              <select
                id="supportType"
                name="supportType"
                required
                class="w-full px-4 py-3 border border-praxis-gray rounded-lg focus:ring-2 focus:ring-praxis-blue focus:border-praxis-blue transition-colors"
              >
                <option value="">Select support type</option>
                <option value="technical">Technical Support</option>
                <option value="billing">Billing & Account</option>
                <option value="integration">Integration Help</option>
                <option value="training">Training & Consultation</option>
                <option value="feature">Feature Request</option>
                <option value="bug">Bug Report</option>
                <option value="other">Other</option>
              </select>
            </div>

            <!-- Priority -->
            <div>
              <label
                for="priority"
                class="block text-sm font-medium text-praxis-dark-blue mb-2"
              >
                Priority Level *
              </label>
              <select
                id="priority"
                name="priority"
                required
                class="w-full px-4 py-3 border border-praxis-gray rounded-lg focus:ring-2 focus:ring-praxis-blue focus:border-praxis-blue transition-colors"
              >
                <option value="">Select priority</option>
                <option value="low">Low - General question</option>
                <option value="normal">Normal - Standard support</option>
                <option value="high">High - Urgent issue</option>
                <option value="critical">Critical - System down</option>
              </select>
            </div>

            <!-- Subject -->
            <div>
              <label
                for="subject"
                class="block text-sm font-medium text-praxis-dark-blue mb-2"
              >
                Subject *
              </label>
              <input
                type="text"
                id="subject"
                name="subject"
                required
                class="w-full px-4 py-3 border border-praxis-gray rounded-lg focus:ring-2 focus:ring-praxis-blue focus:border-praxis-blue transition-colors"
                placeholder="Brief description of your issue"
              />
            </div>

            <!-- Message -->
            <div>
              <label
                for="message"
                class="block text-sm font-medium text-praxis-dark-blue mb-2"
              >
                Detailed Description *
              </label>
              <textarea
                id="message"
                name="message"
                required
                rows="6"
                class="w-full px-4 py-3 border border-praxis-gray rounded-lg focus:ring-2 focus:ring-praxis-blue focus:border-praxis-blue transition-colors resize-vertical"
                placeholder="Please provide detailed information about your issue, including any error messages, steps to reproduce, and relevant context..."
              ></textarea>
            </div>

            <!-- Submit Button -->
            <div class="text-center">
              <button
                type="submit"
                class="btn-accent btn-lg hover-lift active-scale focus-ring px-12"
              >
                Submit Support Request
              </button>
            </div>
          </form>

          <!-- Success Message (Hidden by default) -->
          <div
            id="success-message"
            class="hidden mt-8 p-6 bg-green-50 border border-green-200 rounded-lg"
          >
            <div class="flex items-center">
              <svg
                class="w-6 h-6 text-green-600 mr-3"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"></path>
              </svg>
              <div>
                <h3 class="text-lg font-medium text-green-800">
                  Support Request Submitted
                </h3>
                <p class="text-green-700">
                  Thank you for contacting us. We'll respond within our standard
                  timeframe based on the priority level you selected.
                </p>
              </div>
            </div>
          </div>

          <!-- Error Message (Hidden by default) -->
          <div
            id="error-message"
            class="hidden mt-8 p-6 bg-red-50 border border-red-200 rounded-lg"
          >
            <div class="flex items-center">
              <svg
                class="w-6 h-6 text-red-600 mr-3"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div>
                <h3 class="text-lg font-medium text-red-800">
                  Submission Failed
                </h3>
                <p class="text-red-700">
                  There was an error submitting your support request. Please try
                  again or contact us directly at support@praxisnavigator.io
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  // Support form submission
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById(
      'support-form'
    ) as HTMLFormElement | null;
    const successMessage = document.getElementById(
      'success-message'
    ) as HTMLElement | null;
    const errorMessage = document.getElementById(
      'error-message'
    ) as HTMLElement | null;

    if (form) {
      form.addEventListener('submit', async function (e: Event) {
        e.preventDefault();

        // Hide previous messages
        successMessage?.classList.add('hidden');
        errorMessage?.classList.add('hidden');

        // Get form data
        const formData = new FormData(form);
        const data: Record<string, string> = Object.fromEntries(
          formData
        ) as Record<string, string>;

        // Add timestamp and request type
        data.timestamp = new Date().toISOString();
        data.requestType = 'support';

        try {
          // Submit directly to Cloudflare Worker
          const response = await fetch('/api/contact', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              ...data,
              formType: 'support',
              language: 'en',
            }),
          });

          if (response.ok) {
            // Show success message
            successMessage?.classList.remove('hidden');
            form.reset();

            // Scroll to success message
            successMessage?.scrollIntoView({
              behavior: 'smooth',
              block: 'center',
            });
          } else {
            throw new Error('Form submission failed');
          }
        } catch (error) {
          console.error('Support form submission error:', error);
          errorMessage?.classList.remove('hidden');

          // Scroll to error message
          errorMessage?.scrollIntoView({
            behavior: 'smooth',
            block: 'center',
          });
        }
      });
    }
  });
</script>
