````mdc
# Story 1.4: Analytics and Performance Monitoring

## Status
Approved

## Story
**As a** business stakeholder,  
**I want** privacy-compliant analytics and performance monitoring,  
**so that** I can track website effectiveness while maintaining GDPR compliance.

## Acceptance Criteria
1. Cloudflare Web Analytics integrated without cookies for GDPR compliance
2. Core Web Vitals monitoring configured with performance thresholds
3. Basic error tracking implemented for production monitoring
4. Performance budgets established and monitored in build process
5. Lighthouse CI integration for automated performance testing
6. Analytics dashboard accessible for tracking visitor behavior
7. Privacy policy foundation established for analytics compliance

## Tasks / Subtasks
- [ ] Task 1: Integrate Cloudflare Web Analytics (AC: 1, 6) - **PREREQUISITE FOR ALL OTHER TASKS**
  - [ ] Enable Cloudflare Web Analytics for the domain through Cloudflare dashboard
  - [ ] Add analytics tracking script to base layout with GDPR compliance (cookieless)
  - [ ] Configure custom event tracking for form submissions and demo requests
  - [ ] Set up conversion goal tracking for lead generation metrics
  - [ ] Test analytics data collection and verify dashboard access
  - [ ] Validate GDPR compliance - no cookies or personal data storage

- [ ] Task 2: Implement Core Web Vitals Monitoring (AC: 2) - **REQUIRES Task 1**
  - [ ] Install and configure web-vitals library for Core Web Vitals tracking
  - [ ] Set up performance thresholds: LCP <2.5s, FID <100ms, CLS <0.1
  - [ ] Create performance monitoring components for real-time metrics
  - [ ] Implement automatic reporting to Cloudflare Analytics
  - [ ] Add performance metrics to build process for CI/CD monitoring
  - [ ] Create alerts for performance threshold violations

- [ ] Task 3: Set up Sentry Error Tracking (AC: 3) - **REQUIRES Task 1**
  - [ ] Install Sentry SDK ^7.0.0 for production error monitoring
  - [ ] Configure Sentry with proper error boundaries for React components
  - [ ] Set up structured error reporting with context and user journey data
  - [ ] Configure performance monitoring through Sentry for transaction tracing
  - [ ] Implement error filtering to avoid noise (development errors, browser extensions)
  - [ ] Test error reporting and dashboard access for production monitoring

- [ ] Task 4: Establish Performance Budgets (AC: 4) - **REQUIRES Task 2**
  - [ ] Define performance budgets: Bundle size <500KB initial, <200KB per route
  - [ ] Configure Astro/Vite build process to enforce bundle size limits
  - [ ] Set up build-time performance monitoring with automated warnings
  - [ ] Integrate performance budget checks into CI/CD pipeline
  - [ ] Create build failure conditions for performance threshold violations
  - [ ] Document performance budget guidelines for development team

- [ ] Task 5: Lighthouse CI Integration (AC: 5) - **REQUIRES Tasks 1-4**
  - [ ] Install and configure Lighthouse CI for automated performance testing
  - [ ] Set up Lighthouse CI in GitHub Actions for PR performance testing
  - [ ] Configure Lighthouse thresholds: 90+ scores for Performance, SEO, Accessibility
  - [ ] Implement automated performance regression detection
  - [ ] Create Lighthouse reports accessible through CI/CD dashboard
  - [ ] Set up performance monitoring alerts for production deployments

- [ ] Task 6: Privacy Policy and GDPR Compliance (AC: 7) - **REQUIRES Task 1**
  - [ ] Create privacy policy foundation addressing analytics data collection
  - [ ] Document GDPR compliance measures for cookieless analytics
  - [ ] Add privacy policy page with clear analytics data usage explanation
  - [ ] Implement consent management for any future tracking requirements
  - [ ] Ensure compliance with Norwegian GDPR requirements
  - [ ] Create documentation for ongoing compliance monitoring

- [ ] Task 7: Testing and Validation (Testing Requirements) - **REQUIRES Tasks 1-6**
  - [ ] Create E2E tests for Core Web Vitals performance thresholds
  - [ ] Test error tracking functionality with controlled error scenarios
  - [ ] Validate analytics data collection without cookie usage
  - [ ] Test Lighthouse CI integration in pull request workflow
  - [ ] Verify performance budget enforcement in build process
  - [ ] Validate GDPR compliance and privacy policy accessibility

## Dev Notes

### Previous Story Insights
**[Source: Story 1.1 - Approved, Story 1.2 - Approved, Story 1.3 - Approved]**
- Astro project with TypeScript strict mode established at `/apps/website/`
- Cloudflare Pages deployment pipeline configured and operational
- Navigation and layout components implemented with Praxis design system
- Build process optimized for production with CDN caching enabled
- Environment variables configured for Azure integration

### Analytics & Monitoring Architecture
**[Source: architecture/components.md#analytics-monitoring-component]**
- **Technology Stack**: Cloudflare Web Analytics (cookieless), Sentry ^7.0.0 for error tracking, custom event collection
- **Key Interfaces**: Cloudflare Web Analytics API, Sentry error reporting, custom event tracking
- **Dependencies**: Cloudflare Analytics, Sentry SDK, GDPR compliance utilities
- **Responsibility**: Track user interactions, performance metrics, and error reporting

### Monitoring Stack Requirements
**[Source: architecture/monitoring-and-observability.md]**
- **Frontend Monitoring**: Sentry for error tracking, Cloudflare Web Analytics for performance
- **Performance Monitoring**: Core Web Vitals tracking, API response time monitoring
- **Frontend Metrics**: Core Web Vitals (LCP, FID, CLS), JavaScript errors, API response times, user interactions, conversion funnel metrics
- **Business Metrics**: Lead generation conversion rates by segment, demo request completion rates, Azure Marketplace link clicks

### Performance Requirements
**[Source: prd/technical-assumptions.md]**
- **Core Web Vitals Compliance**: LCP <2.5s, FID <100ms, CLS <0.1
- **Lighthouse Scores**: 90+ for Performance, SEO, Accessibility across all metrics
- **Bundle Size Targets**: <500KB initial bundle, <200KB per route
- **GDPR Compliance**: Cloudflare Web Analytics (cookieless) for Norwegian market compliance

### Security and Performance Standards
**[Source: architecture/security-and-performance.md]**
- **Bundle Size Target**: <500KB initial bundle, <200KB per route
- **Response Time Target**: <200ms for form submissions, <100ms for redirects
- **Performance Optimization**: CDN caching with edge invalidation, static generation with progressive enhancement
- **Frontend Security**: CSP headers, XSS prevention, secure storage patterns

### Technology Stack Integration
**[Source: architecture/tech-stack.md]**
- **Analytics**: Cloudflare Web Analytics (privacy-first, GDPR compliant)
- **Monitoring**: Sentry ^7.0.0 (error tracking and performance monitoring)
- **Testing**: Playwright ^1.37.0 for E2E performance testing
- **Build Tool**: Vite ^4.4.0 with performance budget enforcement

### File Locations and Project Structure
**[Source: architecture/unified-project-structure.md]**
- **Analytics Integration**: Add to `src/layouts/BaseLayout.astro` for global tracking
- **Performance Monitoring**: `src/utils/performance.ts` for Core Web Vitals utilities
- **Error Tracking**: `src/utils/sentry.ts` for Sentry configuration
- **Privacy Policy**: `src/pages/privacy.astro` for GDPR compliance
- **CI Configuration**: `.github/workflows/lighthouse.yml` for automated testing

### Cloudflare Integration Requirements
**[Source: architecture/deployment-architecture.md + external-apis.md]**
- **Cloudflare Pages**: Already configured for hosting with CDN optimization
- **Cloudflare Web Analytics**: Built-in analytics service without cookies
- **Edge Performance**: Global CDN distribution with automatic edge caching
- **Integration**: No additional API calls needed - analytics automatically enabled through dashboard

### Core Web Vitals Implementation
**[Source: Testing examples from architecture/testing-strategy.md]**
Performance testing example shows Core Web Vitals thresholds:
```typescript
expect(metrics.lcp).toBeLessThan(2500); // LCP < 2.5s
expect(metrics.fid).toBeLessThan(100);  // FID < 100ms
expect(metrics.cls).toBeLessThan(0.1);  // CLS < 0.1
```

### GDPR Compliance Requirements
**[Source: prd/technical-assumptions.md + architecture/tech-stack.md]**
- **Privacy-First Analytics**: Cloudflare Web Analytics without cookies
- **GDPR Compliance**: Norwegian market requirements for data privacy
- **No Personal Data Storage**: Analytics collect aggregate data only
- **Consent Management**: Foundation for future tracking requirements
- **Documentation**: Privacy policy required for transparency

### Error Tracking Configuration
**[Source: architecture/components.md + monitoring-and-observability.md]**
- **Sentry SDK**: Version ^7.0.0 for error tracking and performance
- **Error Boundaries**: React component error boundaries for graceful degradation
- **Context Data**: User journey and interaction context for debugging
- **Production Focus**: Error filtering to avoid development noise
- **Transaction Tracing**: Performance monitoring through Sentry

### Performance Budget Enforcement
**[Source: architecture/security-and-performance.md]**
- **Build Integration**: Vite build process with size analysis
- **Automated Checks**: CI/CD pipeline integration for performance validation
- **Bundle Analysis**: Automated bundle size monitoring and alerts
- **Threshold Enforcement**: Build failures for performance violations

## Testing
**[Source: architecture/testing-strategy.md]**
- **Performance Testing**: Core Web Vitals compliance verification in E2E tests
- **Error Tracking Testing**: Controlled error scenarios to validate reporting
- **Analytics Testing**: Verify data collection without cookie usage
- **CI/CD Testing**: Lighthouse CI integration for automated performance monitoring
- **GDPR Compliance Testing**: Validate privacy policy and consent mechanisms

### Definition of Done - Testing Verification
- [ ] Cloudflare Web Analytics collecting data without cookies
- [ ] Core Web Vitals metrics within performance thresholds (LCP <2.5s, FID <100ms, CLS <0.1)
- [ ] Sentry error tracking functional with proper context
- [ ] Performance budgets enforced in build process with automated alerts
- [ ] Lighthouse CI integrated with 90+ scores for Performance, SEO, Accessibility
- [ ] Privacy policy accessible and GDPR compliance verified
- [ ] All monitoring systems operational with dashboard access

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-21 | 1.0 | Initial story creation with comprehensive analytics and performance monitoring architecture context | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here*

````
